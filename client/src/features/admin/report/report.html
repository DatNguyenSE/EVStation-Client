<div class="p-6 bg-gray-50 min-h-screen space-y-8 mt-15">

  <!-- üßæ DANH S√ÅCH B√ÅO C√ÅO -->
  <div class="bg-white shadow rounded-lg p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center gap-2">
      Danh s√°ch b√°o c√°o
    </h2>

    <div *ngIf="reports.length === 0" class="text-gray-500 text-center py-4">
      Kh√¥ng c√≥ b√°o c√°o n√†o.
    </div>

    <div *ngIf="reports.length > 0" class="overflow-x-auto">
      <table class="min-w-full border border-gray-300 rounded-md text-sm">
        <thead class="bg-blue-100">
          <tr>
            <th class="p-2 text-left w-12">ID</th>
            <th class="p-2 text-left w-20">ID Tr·ª•</th>
            <th class="p-2 text-left">M√¥ t·∫£</th>
            <th class="p-2 text-left">Tr·∫°ng th√°i</th>
            <th class="p-2 text-left">ƒê·ªô nghi√™m tr·ªçng</th>
            <th class="p-2 text-left">Nh√¢n vi√™n</th>
            <th class="p-2 text-center w-56">Thao t√°c</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let r of reports" class="border-t hover:bg-gray-50 transition">
            <td class="p-2">{{ r.id }}</td>
            <td class="p-2">{{ r.postId }}</td>
            <td class="p-2">{{ r.description }}</td>
            <td class="p-2">{{ r.status }}</td>
            <td class="p-2">
              <span [ngClass]="{
                'text-red-600 font-semibold': r.severity === 'Critical',
                'text-yellow-600 font-semibold': r.severity === 'Normal'
              }">{{ r.severity }}</span>
            </td>
            <td class="p-2">{{ r.technicianName }}</td>
            <td class="p-2 flex justify-center gap-2 flex-wrap">
              <button class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700"
                      (click)="openDetail(r.id)">Chi ti·∫øt</button>
              <button class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                      (click)="openAssignModal(r)">Giao vi·ªác</button>
              <button class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600"
                      (click)="openEvaluateModal(r)">ƒê√°nh gi√°</button>
              <button class="bg-gray-700 text-white px-3 py-1 rounded text-sm hover:bg-gray-800"
                      (click)="closeReport(r.id)">ƒê√≥ng</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>


  <!-- üßë‚Äçüîß POPUP GIAO VI·ªÜC -->
  <div *ngIf="showAssignModal"
       class="fixed inset-0 backdrop-blur-sm bg-white/20 flex justify-center items-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative animate-fadeIn">
      <button (click)="closeAssignModal()"
              class="absolute top-2 right-2 text-gray-600 hover:text-gray-900 text-lg">‚úï</button>

      <h3 class="text-xl font-semibold mb-4 text-gray-800">Giao vi·ªác cho k·ªπ thu·∫≠t vi√™n</h3>
      <p class="text-gray-600 mb-3">
        B√°o c√°o: <strong>#{{ selectedReportForAssign?.id }} - {{ selectedReportForAssign?.description }}</strong>
      </p>

      <label class="block mb-3">
        Ch·ªçn ID k·ªπ thu·∫≠t vi√™n:
        <input type="text"
               [(ngModel)]="technicianId"
               placeholder="Nh·∫≠p ID k·ªπ thu·∫≠t vi√™n"
               class="border rounded w-full p-2 mt-1 focus:ring focus:ring-blue-200">
      </label>

      <div class="flex justify-end gap-3 mt-4">
        <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
                (click)="assignTechnician(selectedReportForAssign!.id)">
          Giao vi·ªác
        </button>
        <button class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
                (click)="closeAssignModal()">H·ªßy</button>
      </div>
    </div>
  </div>

<!-- üîç POPUP CHI TI·∫æT -->
<div *ngIf="showDetailModal"
     class="fixed inset-0 backdrop-blur-sm bg-white/20 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl p-6 relative animate-fadeIn">
    <button (click)="closeModal()"
            class="absolute top-2 right-2 text-gray-600 hover:text-gray-900 text-lg">‚úï</button>

    <h3 class="text-xl font-semibold mb-3 text-gray-800">
      Chi ti·∫øt b√°o c√°o #{{ selectedReport?.id }}
    </h3>

    <p><strong>M√¥ t·∫£:</strong> {{ selectedReport?.description }}</p>
    <p><strong>Tr·∫°ng th√°i:</strong> {{ selectedReport?.status }}</p>
    <p><strong>ƒê·ªô nghi√™m tr·ªçng:</strong> {{ selectedReport?.severity }}</p>
    <p><strong>Nh√¢n vi√™n:</strong> {{ selectedReport?.staff?.fullName || '-' }}</p>
    <p><strong>K·ªπ thu·∫≠t vi√™n:</strong> {{ selectedReport?.technician?.fullName || '-' }}</p>

    <hr class="my-4">

    <!-- üñºÔ∏è H√¨nh ·∫£nh tr∆∞·ªõc v√† sau -->
    <h4 class="font-medium text-gray-700 mb-2">H√¨nh ·∫£nh b√°o c√°o</h4>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div *ngIf="selectedReport?.createImageUrl; else noBefore"
           class="border rounded-lg overflow-hidden shadow-sm group relative">
        <img [src]="selectedReport!.createImageUrl"
             alt="·∫¢nh khi t·∫°o b√°o c√°o"
             class="w-full h-56 object-cover cursor-pointer transition-transform group-hover:scale-105"
             (click)="openImagePreview(selectedReport!.createImageUrl)">
        <div class="p-2 text-sm text-gray-600 text-center bg-gray-50">Tr∆∞·ªõc khi s·ª≠a</div>
      </div>
      <ng-template #noBefore>
        <div class="border border-dashed border-gray-300 rounded-lg p-6 text-center text-gray-400">
          Ch∆∞a c√≥ ·∫£nh tr∆∞·ªõc khi s·ª≠a
        </div>
      </ng-template>

      <div *ngIf="selectedReport?.completedImageUrl; else noAfter"
           class="border rounded-lg overflow-hidden shadow-sm group relative">
        <img [src]="selectedReport!.completedImageUrl"
             alt="·∫¢nh sau khi ho√†n th√†nh"
             class="w-full h-56 object-cover cursor-pointer transition-transform group-hover:scale-105"
             (click)="openImagePreview(selectedReport!.completedImageUrl)">
        <div class="p-2 text-sm text-gray-600 text-center bg-gray-50">Sau khi s·ª≠a</div>
      </div>
      <ng-template #noAfter>
        <div class="border border-dashed border-gray-300 rounded-lg p-6 text-center text-gray-400">
          Ch∆∞a c√≥ ·∫£nh ho√†n th√†nh
        </div>
      </ng-template>
    </div>

    <hr class="my-4">

    <p class="text-sm text-gray-500">T·∫°o l√∫c: {{ selectedReport?.createAt | date:'short' }}</p>
    <p *ngIf="selectedReport?.fixedAt" class="text-sm text-gray-500">Ho√†n th√†nh: {{ selectedReport?.fixedAt | date:'short' }}</p>
  </div>

  <!-- üñºÔ∏è Popup xem ·∫£nh full -->
  <div *ngIf="previewImageUrl"
       class="fixed inset-0 bg-black/80 flex justify-center items-center z-[60] animate-fadeIn">
    <img [src]="previewImageUrl" alt="Preview" class="max-h-[90vh] max-w-[90vw] rounded shadow-lg">
    <button (click)="closeImagePreview()"
            class="absolute top-4 right-6 text-white text-3xl hover:text-gray-300">‚úï</button>
  </div>
</div>




<!-- üß© POPUP ƒê√ÅNH GI√Å T√åNH TR·∫†NG TR·ª§ -->
<div *ngIf="showEvaluateModal"
     class="fixed inset-0 backdrop-blur-sm bg-white/20 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-lg p-6 relative animate-fadeIn">
    <button (click)="closeEvaluateModal()"
            class="absolute top-2 right-2 text-gray-600 hover:text-gray-900 text-lg">‚úï</button>

    <h3 class="text-xl font-semibold mb-4 text-gray-800">
      ƒê√°nh gi√° t√¨nh tr·∫°ng tr·ª• (#{{ selectedReportForEvaluate?.id }})
    </h3>

    <!-- üñºÔ∏è ·∫¢nh nh√¢n vi√™n g·ª≠i -->
   
    <hr class="my-4">

    <!-- üß© Form ƒë√°nh gi√° -->
    <div class="space-y-3">
      <label class="inline-flex items-center">
        <input type="checkbox" [(ngModel)]="evaluation.isCritical" class="mr-2">
        <span class="font-medium text-gray-700">Nghi√™m tr·ªçng</span>
      </label>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="block">
          B·∫Øt ƒë·∫ßu b·∫£o tr√¨:
          <input type="datetime-local"
                 [(ngModel)]="evaluation.maintenanceStartTime"
                 class="border rounded w-full p-2 mt-1 focus:ring focus:ring-blue-200">
        </label>

        <label class="block">
          K·∫øt th√∫c b·∫£o tr√¨:
          <input type="datetime-local"
                 [(ngModel)]="evaluation.maintenanceEndTime"
                 class="border rounded w-full p-2 mt-1 focus:ring focus:ring-blue-200">
        </label>
      </div>
    </div>

    <div class="flex justify-end gap-3 mt-6">
      <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
              (click)="evaluateReport(selectedReportForEvaluate!.id)">L∆∞u</button>
      <button class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"
              (click)="closeEvaluateModal()">H·ªßy</button>
    </div>
  </div>
</div>
</div>
