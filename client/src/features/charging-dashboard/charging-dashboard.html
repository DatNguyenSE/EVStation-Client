@if (!errorMessage()) {
@if (currentStation()?.status === 'Active') {

<div class="min-h-screen w-full max-w-6xl mx-auto mt-24 p-8">
  <div class="flex flex-col md:flex-row gap-8">

    <!-- THÔNG TIN TRẠM -->
    <div
      class="flex-1 bg-white/80 backdrop-blur-md p-6 rounded-2xl shadow-lg border border-blue-100 hover:shadow-xl transition-all duration-300">
      <div class="flex items-center mb-6">
        <img src="/assets/logo.png" class="w-10 h-10 mr-3" />
        <h2 class="text-2xl font-extrabold text-blue-700 tracking-tight">Thông tin Trạm Sạc</h2>
      </div>

      <div class="space-y-2 text-gray-800 text-base">
        <p><strong>Tên trạm:</strong> {{ currentStation()?.name }}</p>
        <p><strong>Địa chỉ:</strong> {{ currentStation()?.address }}</p>
      </div>

      <div class="mt-6 border-t border-gray-200 pt-4">
        <h3 class="text-lg font-semibold text-blue-600 mb-2 flex items-center gap-2">
          <i class="i-ph-charging-station text-xl"></i> Thông tin trụ sạc
        </h3>
        <ul class="text-gray-700 space-y-1">
          <li><strong>Mã trụ:</strong> {{ postInfo.id }}</li>
          <li><strong>Loại:</strong> {{ postInfo.type }}</li>
          <li><strong>Công suất:</strong> {{ postInfo.powerKW }} kW</li>
          <li><strong>Đầu nối:</strong> {{ postInfo.connectorType }}</li>
          <li>
            <strong>Trạng thái:</strong>
            <span class="px-2 py-0.5 rounded text-sm font-medium" [ngClass]="{
                  'bg-green-100 text-green-700': postInfo.status === 'Available',
                  'bg-yellow-100 text-yellow-700': postInfo.status === 'Charging',
                  'bg-red-100 text-red-700': postInfo.status === 'Offline'
                }">
              {{ postInfo.status }}
            </span>
          </li>
        </ul>
      </div>
    </div>

    <!-- KHU VỰC SẠC -->
    @if (postInfo.status === 'Available') {
    <div
      class="flex-1 bg-white/80 backdrop-blur-md p-6 rounded-2xl shadow-lg border border-green-100 hover:shadow-xl transition-all duration-300 flex flex-col justify-between">
      <div>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-extrabold text-green-700">Đang sạc...</h2>
          <span class="text-sm bg-green-50 text-green-700 px-2 py-1 rounded-md font-medium">
            Phiên #{{ sessionId }}
          </span>
        </div>

        <!-- Vòng tròn pin -->
        <div class="relative w-52 h-52 mx-auto my-8">
          <svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" stroke="#e5e7eb" stroke-width="10" fill="none" />
            <circle cx="50" cy="50" r="45" stroke="#22c55e" stroke-width="10" fill="none" stroke-linecap="round"
              [attr.stroke-dasharray]="282.6" [attr.stroke-dashoffset]="282.6 - (batteryPercent * 2.826)"
              class="transition-all duration-700 ease-in-out" />
          </svg>
          <div class="absolute inset-0 flex flex-col items-center justify-center text-green-600">
            <span class="text-4xl font-extrabold">{{ batteryPercent | number: '1.0-0' }}%</span>
            <span class="text-sm text-gray-500 mt-1">Dung lượng pin</span>
          </div>
        </div>

        <!-- Thông tin realtime -->
        <div class="grid grid-cols-2 gap-4 text-center mt-4">
          <div class="bg-green-50 rounded-xl py-3">
            <p class="text-gray-500 text-sm">Đã nạp</p>
            <p class="text-lg font-bold text-green-700">{{ chargedKwh | number:'1.2-2' }} kWh</p>
          </div>
          <div class="bg-green-50 rounded-xl py-3">
            <p class="text-gray-500 text-sm">Thời gian còn lại</p>
            <p class="text-lg font-bold text-green-700">{{ timeRemain | number:'1.0-0' }} giây</p>
          </div>
          <div class="col-span-2 bg-green-100/50 rounded-xl py-3 mt-1">
            <p class="text-gray-500 text-sm">Chi phí hiện tại</p>
            <p class="text-xl font-bold text-green-700">
              {{ totalPrice | number }} đ
            </p>
          </div>
        </div>
      </div>

      <div class="mt-8 text-center">
        <button (click)="pressEndSession()" [disabled]="isStopping" class="bg-red-500 text-white py-2.5 px-8 rounded-xl font-semibold shadow-md
           hover:bg-red-600 active:scale-95 transition disabled:opacity-50 disabled:cursor-not-allowed">
          @if (isStopping) {
          <span class="animate-pulse">Đang dừng...</span>
          } @else {
          Dừng sạc
          }
        </button>
      </div>
    </div>
    }
  </div>
</div>

} @else {
<!-- TRẠM KHÔNG HOẠT ĐỘNG -->
<div class="flex flex-col items-center justify-center min-h-[70vh] text-gray-700 mt-30">
  <img src="/assets/offline.svg" alt="Offline" class="w-56 mb-6 opacity-80" />
  <h2 class="text-2xl font-bold text-red-600 mb-3">Trạm hiện không hoạt động</h2>
  <p class="text-gray-600">Vui lòng kiểm tra lại kết nối hoặc thử lại sau.</p>
</div>
}
} @else {
<!-- GIAO DIỆN LỖI -->
<div class="flex flex-col mt-30 mb-30 items-center justify-center min-h-[70vh] text-center">
  <h2 class="text-2xl font-bold text-red-600 mb-3">Lỗi khi xác thực trạm sạc</h2>
  <p class="text-gray-700 mb-6 max-w-md">
    {{ errorMessage() }}
  </p>
  <button (click)="this.router.navigate(['/'])"
    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-semibold shadow-md">
    ← Quay về trang chủ
  </button>
</div>
}