<div class="flex justify-center items-center min-h-screen bg-base-300 text-base-content">
  <div class="bg-base-100 shadow-lg rounded-2xl p-8 w-full max-w-lg">

    <h2 class="text-2xl font-bold text-center mb-6 ">
      Đặt chỗ sạc tại trạm {{ station?.name || '...' }}
    </h2>

    <!-- Chọn xe -->
    <div class="mb-5">
      <label class="block mb-2 text-base-content font-semibold"  >Chọn xe</label>
   <div *ngIf="vehicles.length > 0;">
  <select
    [(ngModel)]="vehicleid"
    (change)="onVehicleChange()"
    class="w-full p-2 rounded bg-base-200 border border-blue-600"
  >
     <option value="">Chọn xe của bạn</option>
    <option *ngFor="let v of vehicles" [value]="v.vehicleId">
      {{ v.plate }} - {{ v.model }} ({{ v.type }})
    </option>
  </select>
</div>

    </div>
    
    
    

    <!-- Chọn trụ sạc -->
    <div *ngIf="compatiblePosts.length > 0" class="mb-5">
      <label class="block mb-2 text-base-content font-semibold">Chọn trụ sạc</label>
      <select
        [(ngModel)]="selectedPostId"
        (change)="onPostChange()"
        class="w-full p-2 roundedd bg-base-200 border border-blue-600"
      >
        <option value="">Chọn trụ sạc phù hợp</option>
        <option *ngFor="let p of compatiblePosts" [value]="p.id">
          Trụ #{{ p.id }} - {{ p.powerKW }} kW
        </option>
      </select>
    </div>

    <!-- Chọn ngày -->
    <div *ngIf="availableDates.length > 0" class="mb-5">
      <label class="block mb-2 text-base-content font-semibold">Chọn ngày</label>
      <select
        [(ngModel)]="selectedDate"
        (change)="selectedSlot = undefined"
        class="w-full p-2 rounded bg-base-200 border border-blue-600"
      >
        <option value="">Chọn ngày</option>
        <option *ngFor="let d of availableDates" [value]="d">
          {{ d }}
        </option>
      </select>
    </div>

  <!-- Danh sách slot -->
<div *ngIf="selectedDate && availableSlotsMap[selectedDate]?.length" class="mb-6">
  <label class="block mb-3 text-base-content font-semibold">Chọn thời gian sạc</label>
  <div class="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto">
    <button
      *ngFor="let s of availableSlotsMap[selectedDate]"
      class="py-2 rounded border border-gray-500 hover:bg-blue-600 transition text-sm"
      [ngClass]="{ 'bg-blue-500 text-white': selectedSlot === s.startTime }"
      (click)="onSelectSlot(s)"
      [title]="'Tối đa ' + s.maxConsecutiveSlots + ' slot liên tiếp'"
    >
      {{ s.startTime | date: 'HH:mm' }}
    </button>
  </div>
</div>



    <!-- Thời lượng slot -->
    <div *ngIf="selectedSlot" class="mb-5">
      <label class="block mb-2 text-base-content font-semibold">Số slot (mỗi slot 60 phút)</label>
     <input
  type="number"
  [(ngModel)]="slotCount"
  min="1"
  [max]="selectedSlotObj?.maxConsecutiveSlots || 4"
  class="w-full p-2 rounded bg-base-200 border border-blue-600"
  [disabled]="!selectedSlotObj"
/>
<p class="text-xs text-gray-400 mt-1" *ngIf="selectedSlotObj">
  (Tối đa {{ selectedSlotObj.maxConsecutiveSlots }} slot liên tiếp cho khung giờ này)
</p>
    </div>

    <!-- Nút xác nhận -->
    <button
      (click)="reserve()"
      [disabled]="loading"
      class="w-full bg-blue-600 hover:bg-blue-700 transition py-3 rounded-lg font-semibold"
    >
      <span *ngIf="!loading"> Xác nhận đặt chỗ</span>
      <span *ngIf="loading" class="animate-pulse">Đang xử lý...</span>
    </button>

    <!-- Thông báo -->
    <div *ngIf="message" class="mt-4 text-center text-sm" [ngClass]="{
      'text-green-400': message.startsWith('✅'),
      'text-red-400': message.startsWith('❌') || message.startsWith('Không')
    }">
      {{ message }}
    </div>

  </div>
</div>
