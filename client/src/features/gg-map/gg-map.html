<div class="flex flex-col items-center gap-6 p-6 bg-gray-50 rounded-xl shadow-inner relative">

  <!-- ğŸ§­ TiÃªu Ä‘á» -->
  <h2 class="text-2xl font-bold text-gray-800 text-center">
    ğŸ”Œ TÃ¬m Tráº¡m Sáº¡c Gáº§n Nháº¥t
  </h2>

  <!-- ğŸ“ NÃºt thao tÃ¡c -->
  <div class="flex gap-3 flex-wrap justify-center">
    <button
      (click)="locateMe()"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition"
    >
       ğŸ“ Vá»‹ trÃ­ cá»§a tÃ´i
    </button>

    <button
      (click)="routeToNearest()"
      class="bg-emerald-600 text-white px-4 py-2 rounded-lg shadow hover:bg-emerald-700 transition disabled:opacity-50"
      [disabled]="!nearest"
    >
      ğŸ§­ Chá»‰ Ä‘Æ°á»ng Ä‘áº¿n tráº¡m gáº§n nháº¥t
    </button>
  </div>

  <!-- ğŸ—ºï¸ Map + Search -->
  <div class="relative w-full h-[80vh] rounded-xl overflow-hidden shadow-lg border border-gray-200">
    
    <!-- Ã” tÃ¬m kiáº¿m ná»•i -->
    <div class="absolute top-4 left-1/2 -translate-x-1/2 z-[9999] flex flex-col items-center space-y-2 w-80">
      <div class="bg-white shadow-md rounded-lg flex items-center px-3 py-2 w-72 border border-gray-200">
        <input
          type="text"
          placeholder="ğŸ” TÃ¬m tráº¡m sáº¡c..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="flex-1 text-gray-700 placeholder-gray-400 bg-transparent border-none outline-none text-sm"
        />
        <button
          *ngIf="searchTerm"
          (click)="searchTerm=''; searchResults=[]"
          class="text-gray-400 hover:text-gray-600"
        >âœ–</button>
      </div>

      <!-- Danh sÃ¡ch gá»£i Ã½ -->
      <ul
        *ngIf="searchResults.length > 0"
        class="bg-white shadow-lg rounded-lg w-72 max-h-64 overflow-y-auto border border-gray-200 mt-1"
      >
        <li
          *ngFor="let s of searchResults"
          (click)="focusStation(s)"
          class="px-3 py-2 hover:bg-blue-100 cursor-pointer text-sm border-b last:border-b-0 text-black"
        >
          <b>{{ s.name }}</b><br />
          <span class="text-gray-500 text-xs">{{ s.address }}</span>
        </li>
      </ul>

      <!-- KhÃ´ng cÃ³ káº¿t quáº£ -->
      <div
        *ngIf="searchResults.length === 0 && searchTerm.trim().length >= 2"
        class="bg-white shadow-md rounded-lg px-3 py-2 text-sm text-gray-500 w-72 border border-gray-200 mt-1"
      >
        KhÃ´ng tÃ¬m tháº¥y tráº¡m sáº¡c nÃ o.
      </div>
    </div>

    <!-- Map -->
    <div id="map" class="w-full h-full"></div>
  </div>

  <!-- ğŸ“ ThÃ´ng tin tráº¡m gáº§n nháº¥t -->
  <div
    *ngIf="nearest"
    class="bg-white p-5 rounded-xl shadow-md border border-gray-100 text-center w-full max-w-md mt-6 transition-transform hover:scale-[1.01]"
  >
    <h3 class="text-lg font-semibold text-gray-800 mb-1">Tráº¡m gáº§n nháº¥t:</h3>
    <p class="text-blue-700 font-bold text-lg">{{ nearest?.name }}</p>
    <p class="text-gray-600">{{ nearest?.address }}</p>
    <p class="text-gray-500">
      â° {{ nearest?.openTime }} - {{ nearest?.closeTime }}
    </p>
    <p class="text-gray-700 mt-1">
      âš¡ {{ nearest?.posts?.length || 0 }} cá»•ng sáº¡c |
      ğŸš— {{ nearestDistance?.toFixed(2) }} km
    </p>
  </div>

  <!-- ğŸ”‹ Danh sÃ¡ch táº¥t cáº£ tráº¡m -->
  <div
    class="w-full max-w-5xl mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
  >
    <div
      *ngFor="let s of stations"
      class="bg-white border border-gray-100 rounded-xl p-5 shadow hover:shadow-lg hover:-translate-y-1 transition"
    >
      <h4 class="font-bold text-blue-800 text-lg mb-1">{{ s.name }}</h4>
      <p class="text-gray-600 text-sm mb-1">ğŸ“ {{ s.address }}</p>
      <p class="text-gray-500 text-sm mb-1">
        â° {{ s.openTime }} - {{ s.closeTime }}
      </p>
      <p class="text-gray-700 text-sm">
        âš¡ {{ s.posts?.length || 0 }} cá»•ng sáº¡c
      </p>

      <button
        (click)="nearest = s; routeToNearest()"
        class="mt-4 bg-blue-500 text-white w-full py-2 rounded-lg hover:bg-blue-600 transition"
      >
        ğŸ§­ Chá»‰ Ä‘Æ°á»ng tá»›i Ä‘Ã¢y
      </button>
    </div>
  </div>

  <!-- ğŸ“¡ Pháº£n há»“i tá»« backend -->
  <div
    *ngIf="lastResponse"
    class="mt-6 bg-gray-50 border rounded-lg p-4 text-sm text-gray-600 w-full max-w-md shadow-inner"
  >
    <strong class="block mb-1">ğŸ“¡ Pháº£n há»“i tá»« server:</strong>
    <pre class="whitespace-pre-wrap">{{ lastResponse | json }}</pre>
  </div>
</div>
